<!doctype html><html lang=fa dir=rtl><head><meta charset=UTF-8><title>TGJU Fetcher - v1.0.1</title><style>body{font-family:Tahoma,Arial,sans-serif;background:#f3f4f6;margin:0;padding:20px;padding-bottom:80px;display:flex;flex-direction:column;align-items:center}.creator-link{width:100%;text-align:center;font-size:1em;font-weight:400;margin-top:16px}.creator-link a{color:#0b5ed7;text-decoration:none;font-weight:700}.container{width:98%;max-width:1200px;background:#fff;padding:25px;border-radius:16px;border:1px solid #cbd5e1;box-shadow:0 8px 24px rgba(15,23,42,.08)}h1{text-align:center;color:#0f172a;margin-bottom:20px;font-size:22px}.guide{font-size:13px;color:#1e293b;background:#eef2ff;padding:15px;border-radius:8px;margin-bottom:20px;line-height:1.8;border:1px solid #c7d2fe}label{font-size:14px;color:#334155;margin-bottom:6px;display:block;font-weight:700}input[type=text],input[type=number]{width:100%;padding:12px;border-radius:8px;border:1px solid #94a3b8;margin-bottom:15px;background:#fff;font-size:14px;box-sizing:border-box;text-align:left;direction:ltr}input::placeholder{text-align:left;direction:ltr}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-moz-appearance:textfield;text-align:center}button{width:100%;padding:14px;background:#0b5ed7;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:16px;font-weight:700;margin-bottom:10px;font-family:Tahoma,Arial,sans-serif}button:hover{background:#084298}button:disabled{opacity:.75;cursor:wait}.status{margin-top:10px;font-size:14px;color:#1f2937;text-align:center;font-weight:700;min-height:22px}.spinner{display:none;width:14px;height:14px;border:2px solid #cbd5e1;border-top-color:#0b5ed7;border-radius:50%;animation:spin 1s linear infinite;vertical-align:middle;margin-left:8px}@keyframes spin{to{transform:rotate(360deg)}}table{width:100%;border-collapse:collapse;margin-top:20px;direction:ltr}th{background:#e2e8f0;padding:12px;border:1px solid #cbd5e1;color:#0f172a}td{padding:10px;border:1px solid #e5e7eb;background:#fff;text-align:center}#resultTable tbody tr:nth-child(even) td{background:#e8eef7}.cellval{cursor:pointer;display:inline-grid}.cellval::after{content:attr(data-v);font-weight:700;visibility:hidden;grid-area:1/1}.cellvalspan{grid-area:1/1;font-weight:400}.cellval.picked .cellvalspan{font-weight:700}.pos{color:#008000!important;font-weight:700}.neg{color:#ff0000!important;font-weight:700}#downloadBtn{background:#198754;margin-top:20px}#downloadBtn:hover{background:#146c43}.copy-toast{position:fixed;bottom:12px;left:12px;background:#0f172a;color:#fff;padding:10px 12px;border-radius:10px;font-size:13px;box-shadow:0 8px 24px rgba(15,23,42,.25);z-index:9999;direction:rtl;max-width:70vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;opacity:0;transform:translateY(8px);pointer-events:none;transition:opacity .22s ease,transform .22s ease}.copy-toast.show{opacity:1;transform:translateY(0)}</style></head><body><div class=container><h1 id=mainTitle>استخراج کننده دیتا از سایت TGJU برای دارایی XX</h1><div class=guide>لینک صفحه یک دارایی رو از سایت TGJU کپی کنید و در باکس آدرس قرار دهید.<br>نمونه: <b>https://www.tgju.org/profile/price_dollar_rl</b></div><label>آدرس صفحه:</label><input type=text id=url placeholder=https://www.tgju.org/profile/... oninput=checkURL(this.value)><label>(هر یک ماه = 30 روز کاری بازار) از دیروز، تا چند ماه گذشته؟</label><input type=number id=maxRows value=12><button id=fetchBtn>دریافت</button><div class=status id=status><span id=spinner class=spinner></span><span id=statusText></span></div><button id=downloadBtn style=display:none>دانلود فایل خروجی (JSON.txt)</button><table id=resultTable style=display:none><thead><tr><th>بازگشایی</th><th>کمترین</th><th>بیشترین</th><th>پایانی</th><th>میزان تغییرات</th><th>درصد تغییرات</th><th>تاریخ میلادی</th><th>تاریخ شمسی</th></tr></thead><tbody id=tableBody></tbody></table><div class=creator-link>by <a href=https://github.com/sMohammad14 target=_blank><b>sMohammad14</b></a></div></div><div id=copyToast class=copy-toast>در کلیپ بورد کپی شد!</div><script>function cleanAll(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent.trim().replace(/,/g,"")}function checkURL(e){const t=document.getElementById("mainTitle"),n=e.match(/\/profile\/([^/?#]+)/i);return n?(t.innerText="استخراج کننده دیتا از سایت TGJU برای دارایی "+n[1].toUpperCase(),n[1]):null}const fetchBtn=document.getElementById("fetchBtn"),tableBody=document.getElementById("tableBody"),downloadBtn=document.getElementById("downloadBtn"),spinner=document.getElementById("spinner"),statusText=document.getElementById("statusText"),copyToast=document.getElementById("copyToast");let lastPicked=null,toastTimer=null;function setLoading(e){fetchBtn.disabled=e,e?(fetchBtn.dataset.ot=fetchBtn.innerText,fetchBtn.innerText="در حال دریافت...",spinner.style.display="inline-block"):(fetchBtn.innerText=fetchBtn.dataset.ot||"دریافت",spinner.style.display="none")}async function copyToClipboard(e){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(e);const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",t.style.top="0",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}finally{document.body.removeChild(t)}}function showToast(){copyToast.classList.add("show"),toastTimer&&clearTimeout(toastTimer),toastTimer=setTimeout(()=>{copyToast.classList.remove("show")},1400)}document.addEventListener("click",async e=>{const t=e.target;if(!(t.classList&&t.classList.contains("cellvalspan")))return;const n=t.dataset.v??t.textContent;try{await copyToClipboard(n);const o=t.parentElement;lastPicked&&lastPicked.classList.remove("picked"),o.classList.add("picked"),lastPicked=o,showToast()}catch(e){}});fetchBtn.addEventListener("click",async()=>{let e=document.getElementById("url").value.trim();const t=document.getElementById("maxRows").value,n=30,o=30*parseInt(t||"0");if(!e)return alert("لطفا لینک را وارد کنید");const a=checkURL(e);a&&!e.includes("api.tgju.org")?e=`https://api.tgju.org/v1/market/indicator/summary-table-data/${a}?lang=fa&order_dir=desc&convert_to_ad=1`:e.includes("api.tgju.org")&&(()=>{const t=new URL(e);t.searchParams.set("order_dir","desc"),e=t.toString()})();const r=new URL(e);r.searchParams.set("length",n),statusText.innerText="در حال دریافت داده‌ها...",setLoading(!0);let i=[],s=0;try{for(;i.length<parseInt(o);){r.searchParams.set("start",s);const e=await fetch(r.toString()),t=await e.json();if(!t.data||0===t.data.length)break;i=i.concat(t.data),statusText.innerText=`در حال دریافت داده‌ها... (${i.length})`,i.length>=parseInt(o)&&(i=i.slice(0,parseInt(o)));s+=parseInt(n),await new Promise(e=>setTimeout(e,200))}render(i)}catch(e){statusText.innerText="خطا در لینک یا ارتباط."}finally{setLoading(!1)}});function makeTd(e,t){const n=document.createElement("td");t&&(n.className=t);const o=document.createElement("span");o.className="cellval",o.dataset.v=e;const a=document.createElement("span");return a.className="cellvalspan",a.dataset.v=e,a.textContent=e,o.appendChild(a),n.appendChild(o),n}function render(e){tableBody.innerHTML="";const t=[];e.forEach(e=>{const n=parseFloat(cleanAll(e[0])),o=parseFloat(cleanAll(e[3])),a=o-n,r=(0!==n?100*a/n:0).toFixed(2),i=a>=0?"pos":"neg",s=a>0?"+":"",l={"Open":cleanAll(e[0]),"Lowest":cleanAll(e[1]),"Highest":cleanAll(e[2]),"End":cleanAll(e[3]),"Different":s+a.toString(),"Percent of Different":s+r+"%","Date":cleanAll(e[6]),"IR Date":cleanAll(e[7])};t.push(l);const d=document.createElement("tr");d.appendChild(makeTd(l["Open"])),d.appendChild(makeTd(l["Lowest"])),d.appendChild(makeTd(l["Highest"])),d.appendChild(makeTd(l["End"])),d.appendChild(makeTd(l["Different"],i)),d.appendChild(makeTd(l["Percent of Different"],i)),d.appendChild(makeTd(l["Date"])),d.appendChild(makeTd(l["IR Date"])),tableBody.appendChild(d)}),document.getElementById("resultTable").style.display="table",statusText.innerText="اطلاعات "+t.length+" روز کاری گذشته بازار استخراج شد";const n=JSON.stringify(t,null,2);downloadBtn.style.display="block",downloadBtn.onclick=()=>{const e=new Blob([n],{type:"text/plain"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="tgju_data_desc.txt",t.click()}}</script></body></html>

